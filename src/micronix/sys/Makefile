
INC = ../include
SYS = ../include/sys

HIGH_AS	= inits.o
IO_AS	= intrpt.o mio.o
LOW_AS	= uhdr.o mem.o sub8.o
AS_OBJS = $(HIGH_AS) $(IO_AS) $(LOW_AS)

LOW_C = mount.o access.o balloc.o cio.o create.o exec.o fio.o fork.o \
	ialloc.o iget.o imap.o link.o user.o malloc.o name.o open.o queue.o \
	rdwri.o reg.o sig.o sleep.o subc.o swap.o sys1.o sys2.o system.o time.o \
	trap.o tty.o uio.o
IO_C = con.o dj.o memdev.o multio.o mw.o
HIGH_C = main.o cus.o

LOW_OFILES = $(LOW_AS) $(LOW_C)
IO_OFILES = $(IO_C) $(IO_AS)
HIGH_OFILES = $(HIGH_C) $(HIGH_AS)
CFLAGS = -i $(INC)/

unix : low.o io.o high.o
	link -tb0x1000 -r -o unix low.o io.o -lm.a high.o

$(AS_OBJS) : $*.s
	as $*.s

$(HIGH_C) : $*.c
	cc $(CFLAGS) -c -x0 $*.c

$(LOW_C) $(IO_C) : $*.c
	cc $(CFLAGS) -c $*.c

low.o: $(LOW_OFILES)
	link -tb0x1000 -d -o low.o $(LOW_OFILES)

io.o:	$(IO_OFILES) 
	link -tb0x1000 -d -o io.o $(IO_OFILES)

high.o:	$(HIGH_OFILES)
	link -tb0x1000 -d -o high.o $(HIGH_OFILES)

makedate: makedate.c
	cc -o makedate makedate.c -lS

build.h: makedate
	./makedate

#
# include file dependencies
#
user.o:	user.c
	cc $(CFLAGS) -c -x7 user.c

install: unix

clean:
	rm *.o unix

#
# dependencies generated by
#
# fgrep '#include' *.c | tr -d '"' | sed 's/#include//' | awk '
#	{ if ($1 != f) { printf("\n%s", $1); f = $1 } }
#	{ printf(" %s", $2) }
# END { printf("\n") }
# '

access.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/mount.h $(SYS)/proc.h
balloc.o: $(SYS)/sys.h $(SYS)/buf.h $(SYS)/proc.h
cio.o: $(SYS)/sys.h $(SYS)/con.h $(SYS)/file.h $(SYS)/inode.h $(SYS)/proc.h
con.o: $(SYS)/sys.h $(SYS)/con.h
create.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/proc.h
cus.o: $(SYS)/sys.h $(SYS)/tty.h
dj.o: $(SYS)/sys.h $(SYS)/buf.h $(SYS)/con.h $(SYS)/proc.h
exec.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/proc.h $(SYS)/buf.h $(INC)/obj.h
fio.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/buf.h $(SYS)/con.h $(SYS)/proc.h
fork.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/proc.h $(SYS)/file.h $(SYS)/con.h
ialloc.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/proc.h $(SYS)/buf.h
iget.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/mount.h $(SYS)/buf.h $(SYS)/proc.h
imap.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/buf.h $(SYS)/proc.h
link.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/proc.h
lock.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/proc.h $(SYS)/file.h $(SYS)/lock.h
main.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/mount.h $(SYS)/proc.h $(SYS)/file.h $(SYS)/buf.h $(SYS)/con.h build.h
makedate.o: $(INC)/std.h $(INC)/time.h
malloc.o: $(SYS)/sys.h $(SYS)/proc.h $(SYS)/buf.h $(SYS)/con.h
memdev.o: $(SYS)/sys.h $(SYS)/proc.h $(SYS)/con.h
mount.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/mount.h $(SYS)/proc.h $(SYS)/buf.h
mset.o: $(SYS)/tty.h
multio.o: $(SYS)/sys.h $(SYS)/tty.h $(SYS)/proc.h
mw.o: $(SYS)/sys.h $(SYS)/buf.h $(SYS)/proc.h $(SYS)/con.h
name.o: $(SYS)/sys.h $(SYS)/buf.h $(SYS)/proc.h $(SYS)/inode.h
open.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/proc.h $(SYS)/file.h $(SYS)/con.h
queue.o: $(SYS)/sys.h $(SYS)/tty.h $(SYS)/proc.h
rdwri.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/file.h $(SYS)/proc.h
reg.o: $(SYS)/sys.h $(SYS)/proc.h
sig.o: $(SYS)/sys.h $(SYS)/proc.h $(SYS)/tty.h
sleep.o: $(SYS)/sys.h $(SYS)/proc.h
subc.o: $(SYS)/sys.h $(SYS)/con.h
swap.o: $(SYS)/sys.h $(SYS)/proc.h $(SYS)/buf.h $(SYS)/con.h
sys1.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/file.h $(SYS)/proc.h
sys2.o: $(SYS)/sys.h $(SYS)/inode.h $(SYS)/proc.h $(SYS)/file.h
system.o: $(SYS)/sys.h $(SYS)/proc.h
time.o: $(SYS)/sys.h $(SYS)/proc.h
trap.o: $(SYS)/sys.h $(SYS)/proc.h
tty.o: $(SYS)/sys.h $(SYS)/tty.h $(SYS)/proc.h
uio.o: $(SYS)/sys.h $(SYS)/proc.h $(SYS)/buf.h $(SYS)/con.h
user.o: $(SYS)/sys.h $(SYS)/proc.h
