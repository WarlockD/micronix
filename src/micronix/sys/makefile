
HIGH_AS	= inits.o
IO_AS	= intrpt.o mio.o
LOW_AS	= uhdr.o mem.o sub8.o
AS_OBJS = $(HIGH_AS) $(IO_AS) $(LOW_AS)

LOW_C = mount.o access.o balloc.o cio.o create.o exec.o fio.o fork.o \
	ialloc.o iget.o imap.o link.o user.o malloc.o name.o open.o queue.o \
	rdwri.o reg.o sig.o sleep.o subc.o swap.o sys1.o sys2.o system.o time.o \
	trap.o tty.o uio.o
IO_C = con.o dj.o memdev.o multio.o mw.o
HIGH_C = main.o cus.o

LOW_OFILES = $(LOW_AS) $(LOW_C)
IO_OFILES = $(IO_C) $(IO_AS)
HIGH_OFILES = $(HIGH_C) $(HIGH_AS)

unix : low.o io.o high.o
	link -tb0x1000 -r -o unix low.o io.o -lm.a high.o

$(AS_OBJS) : $*.s
	as $*.s

$(HIGH_C) : $*.c
	cc -c -x0 $*.c

$(LOW_C) $(IO_C) : $*.c
	cc -c $*.c

low.o: $(LOW_OFILES)
	link -tb0x1000 -d -o low.o $(LOW_OFILES)

io.o:	$(IO_OFILES) 
	link -tb0x1000 -d -o io.o $(IO_OFILES)

high.o:	$(HIGH_OFILES)
	link -tb0x1000 -d -o high.o $(HIGH_OFILES)

makedate: makedate.c
	cc -o makedate makedate.c -lS

build.h: makedate
	./makedate >build.h

#
# include file dependencies
#
user.o:	user.c proc.h sys.h
	cc -c -x7 user.c

install:

clean:
	rm *.o unix

#
# dependencies generated by
#
# fgrep '#include' *.c | tr -d '"' | sed 's/#include//' | awk '
#	{ if ($1 != f) { printf("\n%s", $1); f = $1 } }
#	{ printf(" %s", $2) }
# END { printf("\n") }
# '

access.c: sys.h inode.h mount.h proc.h
balloc.c: sys.h buf.h sup.h proc.h
cio.c: sys.h con.h file.h inode.h proc.h
con.c: sys.h con.h
create.c: sys.h inode.h proc.h
cus.c: sys.h tty.h
dj.c: sys.h buf.h con.h proc.h
exec.c: sys.h inode.h proc.h buf.h obj.h
fio.c: sys.h inode.h buf.h con.h proc.h
fork.c: sys.h inode.h proc.h file.h con.h
ialloc.c: sys.h inode.h proc.h buf.h sup.h
iget.c: sys.h inode.h mount.h buf.h proc.h
imap.c: sys.h inode.h buf.h proc.h
link.c: sys.h inode.h proc.h
lock.c: sys.h inode.h proc.h file.h lock.h
main.c: sys.h inode.h mount.h proc.h file.h buf.h con.h build.h
makedate.c: <std.h> <time.h>
malloc.c: sys.h proc.h buf.h sup.h con.h
memdev.c: sys.h proc.h con.h
mount.c: sys.h inode.h mount.h proc.h buf.h sup.h
mset.c: tty.h
multio.c: sys.h tty.h proc.h
mw.c: sys.h buf.h proc.h con.h
name.c: sys.h buf.h proc.h inode.h
open.c: sys.h inode.h proc.h file.h con.h
queue.c: sys.h tty.h proc.h
rdwri.c: sys.h inode.h file.h proc.h
reg.c: sys.h proc.h
sig.c: sys.h proc.h tty.h
sleep.c: sys.h proc.h
subc.c: sys.h con.h
swap.c: sys.h proc.h buf.h con.h
sys1.c: sys.h inode.h file.h proc.h
sys2.c: sys.h inode.h proc.h file.h
system.c: sys.h proc.h
time.c: sys.h proc.h
trap.c: sys.h proc.h
tty.c: sys.h tty.h proc.h
uio.c: sys.h proc.h buf.h con.h sup.h
user.c: sys.h proc.h
