fix portability stuff,
like no system include stuff, knowledge of system structs

